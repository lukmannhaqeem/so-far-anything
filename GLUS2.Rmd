---
title: Can you prove that orangutans use the wildlife corridor? 
author: Lukmann Haqeem
date: "`r format(Sys.time(), '%d %B, %Y')`"
bibliography: scholar.bib
output:
     pdf_document: default
     html_document: default
---
\
\
Probably the best approach to monitor orangutan movement is to fit a GPS tracking device on the animal. However,
finding a single animal can be very challenging. Moreover, this method often involves shooting the
animal from tree with the tranquilizer, the animal could fall to the ground and get injured or even
die. Even if safe capture is possible and surveyors can fit tracker on the animal, there is also
concern that the animal will grab and remove the tracker out because it is just too nimble and too
strong [@trayford2012assessment].
Perhaps a safer approach to monitor movement is to follow the animal wherever it goes and records
its position regularly with a GPS device [@ancrenaz2004orangutan]. While it is easy for orangutan
to move from point to point through canopy at the swampy area, following the animal from the
ground can be difficult. There is a good chance that surveyors could not catch up with the animal
and lose sight of it during the follow. 

Surveying orangutan nest is much easier than the animal itself, and many surveyors actually
preferred this approach. The question is, can I use the nest as a proxy for monitoring animal movement?
Since orangutan leaves a trail of nests as it moves through the forest, it might be possible to
trace the animal's movement pattern. IF new and unmarked nests are found during a repeat visit at
the transects, I can assume that the animal had re-located or moved since the last visit.
Also, because new nests are built daily I would expect to see somewhat active movement by the
animal throughout the study period. 
```{r packages, include = FALSE}
	library(tidyverse) 
	library(MASS)
	library(unmarked) 
	library(ggplot2) 
	library(viridis) 
	library(mgcv) 
	library(plyr)
	library(jagsUI)
	library(beepr)
	library(jagsUI)
	library(mcmcOutput)
```
```{r copy, echo = FALSE}
	id <- 1:1000000
	x <- rep(1:1000, each = 1000)
	y <- rep(1:1000, times = 1000)
	alt <- (y + 2*y^2) / 1000 
	elevation <- scale(alt) 
	tree <- y + -0.1*y^2
	forest <- scale(tree)
	study_area <- data.frame(id, x, y, elevation, forest)
	save(study_area, file = "study_area.RData")
```

Load the 'environment'.
```{r study_area}
	load("study_area.RData")
	head(study_area)
```
```{r border, include = FALSE}
	c_borderX <- seq(min(x), max(x), length = 4)
	c_borderY <- seq(min(y), max(y), length = 6)
```
```{r fig1, echo=FALSE, fig.height = 4, fig.width = 9, fig.align = 'center'}
	elevation <- ggplot() + 
		geom_tile(data = study_area, aes(x = x, y = y, fill = elevation)) +
		scale_fill_gradient(low = "grey88", high = "#E69F00") +
		xlab("x-coordinate") +
		ylab("y-coordinate") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[2], xmax = c_borderX[3], ymin = c_borderY[2], ymax = c_borderY[5]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[1], ymax = c_borderY[2]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[5], ymax = c_borderY[6]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		annotate(geom="text", x = mean(x), y = 100, label = "TPA A", 
				 size=4, color="red") +
		annotate(geom="text", x = mean(x), y = mean(y), label = "CORRIDOR", 
				 size=4, color="red") +
		annotate(geom="text", x = mean(x), y = 900, label = "TPA B", 
				 size=4, color="red") +
		theme_light() 
	forest <- ggplot() + 
		geom_tile(data = study_area, aes(x = x, y = y, fill = forest)) +
		scale_fill_gradient(low = "grey88", high = "#009E73") +
		xlab("x-coordinate") +
		ylab("y-coordinate") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[2], xmax = c_borderX[3], ymin = c_borderY[2], ymax = c_borderY[5]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[1], ymax = c_borderY[2]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[5], ymax = c_borderY[6]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		annotate(geom="text", x = mean(x), y = 100, label = "TPA A", 
				 size=4, color="red") +
		annotate(geom="text", x = mean(x), y = mean(y), label = "CORRIDOR", 
				 size=4, color="red") +
		annotate(geom="text", x = mean(x), y = 900, label = "TPA B", 
				 size=4, color="red") +
		theme_light() 
	cowplot::plot_grid(elevation, forest, nrow = 1)
```
```{r feature engineering, echo = FALSE}
	set.seed(1234)
	lambda <- 20
	centre_line <- seq(min(x), max(x), length = 9)

	#t1
	tmp <- rnorm(10000, c_borderY[5], 50)
	height <- round_any(tmp, 1) 
	
	width <- round((centre_line[2]-50) : (centre_line[2]+50))
	n <- rpois(1, lambda)
	detect_y1 <- sample(height, n, replace = TRUE)
	detect_x1 <- sample(width, length(detect_y1))
	
	width <- round((centre_line[3]-50) : (centre_line[3]+50))
	n <- rpois(1, lambda)
	detect_y2 <- sample(height, n, replace = TRUE)
	detect_x2 <- sample(width, length(detect_y2))

	width <- round((centre_line[4]-50) : (centre_line[4]+50))
	n <- rpois(1, lambda)
	detect_y3 <- sample(height, n, replace = TRUE)
	detect_x3 <- sample(width, length(detect_y3))

	width <- round((centre_line[5]-50) : (centre_line[5]+50))
	n <- rpois(1, lambda)
	detect_y4 <- sample(height, n, replace = TRUE)
	detect_x4 <- sample(width, length(detect_y4))

	width <- round((centre_line[6]-50) : (centre_line[6]+50))
	n <- rpois(1, lambda)
	detect_y5 <- sample(height, n, replace = TRUE)
	detect_x5 <- sample(width, length(detect_y5))

	width <- round((centre_line[7]-50) : (centre_line[7]+50))
	n <- rpois(1, lambda)
	detect_y6 <- sample(height, n, replace = TRUE)
	detect_x6 <- sample(width, length(detect_y6))

	width <- round((centre_line[8]-50) : (centre_line[8]+50))
	n <- rpois(1, lambda)
	detect_y7 <- sample(height, n, replace = TRUE)
	detect_x7 <- sample(width, length(detect_y7))
	
	detect_y <- c(detect_y1, detect_y2, detect_y3, detect_y4) #, detect_y5, detect_y6, detect_y7)
	detect_x <- c(detect_x1, detect_x2, detect_x3, detect_x4) #, detect_x5, detect_x6, detect_x7)
	detect_elevation <- detect_forest  <- numeric(length(detect_x)) 
	for(i in 1:length(detect_x)){
		detect_elevation[i] <- study_area[which(study_area$x == detect_x[i] & study_area$y == detect_y[i]), 4]
		detect_forest[i] <- study_area[which(study_area$x == detect_x[i] & study_area$y == detect_y[i]), 5]
	}

	data1 <- data.frame(id = 1:length(detect_x),
					   x = detect_x, 
					   y = detect_y, 
					   elevation = detect_elevation, 
					   forest = detect_forest)
	data1 <- data1[order(data1$y),]
	scale_y <- scale(data1$y)
	scale_forest <- scale(data1$forest)
	data1$count <- as.integer(rpois(length(detect_x), 3)) 						
	data1$session <- "A"

	#t2
	tmp <- rnorm(10000, c_borderY[3], 50)
	height <- round_any(tmp, 1) 
	
	width <- round((centre_line[2]-50) : (centre_line[2]+50))
	n <- rpois(1, lambda)
	detect_y1 <- sample(height, n, replace = TRUE)
	detect_x1 <- sample(width, length(detect_y1))
	
	width <- round((centre_line[3]-50) : (centre_line[3]+50))
	n <- rpois(1, lambda)
	detect_y2 <- sample(height, n, replace = TRUE)
	detect_x2 <- sample(width, length(detect_y2))

	width <- round((centre_line[4]-50) : (centre_line[4]+50))
	n <- rpois(1, lambda)
	detect_y3 <- sample(height, n, replace = TRUE)
	detect_x3 <- sample(width, length(detect_y3))

	width <- round((centre_line[5]-50) : (centre_line[5]+50))
	n <- rpois(1, lambda)
	detect_y4 <- sample(height, n, replace = TRUE)
	detect_x4 <- sample(width, length(detect_y4))

	width <- round((centre_line[6]-50) : (centre_line[6]+50))
	n <- rpois(1, lambda)
	detect_y5 <- sample(height, n, replace = TRUE)
	detect_x5 <- sample(width, length(detect_y5))

	width <- round((centre_line[7]-50) : (centre_line[7]+50))
	n <- rpois(1, lambda)
	detect_y6 <- sample(height, n, replace = TRUE)
	detect_x6 <- sample(width, length(detect_y6))

	width <- round((centre_line[8]-50) : (centre_line[8]+50))
	n <- rpois(1, lambda)
	detect_y7 <- sample(height, n, replace = TRUE)
	detect_x7 <- sample(width, length(detect_y7))
	
	detect_y <- c(detect_y2, detect_y3, detect_y4, detect_y5) #detect_y1, detect_y6, detect_y7)
	detect_x <- c(detect_x2, detect_x3, detect_x4, detect_x5) #detect_y1, detect_x6, detect_x7)
	detect_elevation <- detect_forest  <- numeric(length(detect_x)) 
	for(i in 1:length(detect_x)){
		detect_elevation[i] <- study_area[which(study_area$x == detect_x[i] & study_area$y == detect_y[i]), 4]
		detect_forest[i] <- study_area[which(study_area$x == detect_x[i] & study_area$y == detect_y[i]), 5]
	}

	data2 <- data.frame(id = 1:length(detect_x),
					   x = detect_x, 
					   y = detect_y, 
					   elevation = detect_elevation, 
					   forest = detect_forest)
	data2 <- data2[order(data2$y),]
	scale_y <- scale(data2$y)
	scale_forest <- scale(data2$forest)
	data2$count <- as.integer(rpois(nrow(data2), 3)) 
	data2$session <- "B"
	
	#t3
	tmp <- rnorm(10000, c_borderY[2], 50)
	height <- round_any(tmp, 1) 
	
	width <- round((centre_line[2]-50) : (centre_line[2]+50))
	n <- rpois(1, lambda)
	detect_y1 <- sample(height, n, replace = TRUE)
	detect_x1 <- sample(width, length(detect_y1))
	
	width <- round((centre_line[3]-50) : (centre_line[3]+50))
	n <- rpois(1, lambda)
	detect_y2 <- sample(height, n, replace = TRUE)
	detect_x2 <- sample(width, length(detect_y2))

	width <- round((centre_line[4]-50) : (centre_line[4]+50))
	n <- rpois(1, lambda)
	detect_y3 <- sample(height, n, replace = TRUE)
	detect_x3 <- sample(width, length(detect_y3))

	width <- round((centre_line[5]-50) : (centre_line[5]+50))
	n <- rpois(1, lambda)
	detect_y4 <- sample(height, n, replace = TRUE)
	detect_x4 <- sample(width, length(detect_y4))

	width <- round((centre_line[6]-50) : (centre_line[6]+50))
	n <- rpois(1, lambda)
	detect_y5 <- sample(height, n, replace = TRUE)
	detect_x5 <- sample(width, length(detect_y5))

	width <- round((centre_line[7]-50) : (centre_line[7]+50))
	n <- rpois(1, lambda)
	detect_y6 <- sample(height, n, replace = TRUE)
	detect_x6 <- sample(width, length(detect_y6))

	width <- round((centre_line[8]-50) : (centre_line[8]+50))
	n <- rpois(1, lambda)
	detect_y7 <- sample(height, n, replace = TRUE)
	detect_x7 <- sample(width, length(detect_y7))
	
	detect_y <- c(detect_y4, detect_y5, detect_y6, detect_y7) #detect_y1, detect_y2, detect_y3 
	detect_x <- c(detect_x4, detect_x5, detect_x6, detect_x7) #detect_x1, detect_x2, detect_x3
	detect_elevation <- detect_forest  <- numeric(length(detect_x)) 
	for(i in 1:length(detect_x)){
		detect_elevation[i] <- study_area[which(study_area$x == detect_x[i] & study_area$y == detect_y[i]), 4]
		detect_forest[i] <- study_area[which(study_area$x == detect_x[i] & study_area$y == detect_y[i]), 5]
	}

	data3 <- data.frame(id = 1:length(detect_x),
					   x = detect_x, 
					   y = detect_y, 
					   elevation = detect_elevation, 
					   forest = detect_forest)
	data3 <- data3[order(data3$y),]
	scale_y <- scale(data3$y)
	scale_forest <- scale(data3$forest)
	data3$count <- as.integer(rpois(nrow(data3), 3)) 
	data3$session <- "C"
	data <- rbind(data1, data2, data3)
	save(data, file = "nest_data.RData")
```
\
Load the 'observations'.
```{r data}
	load("nest_data.RData")
	head(data)
```

Because I wanted to know whether orangutans move between two Totally Protected Areas (TPAs), I need to
survey areas adjacent to the proposed wildlife corridor, including the TPAs. This is to verify whether 1) the animals used TPAs
recently and 2) the animals not using different pathways to go across TPAs. The transect spacing is the
average daily distance range of adult orangutans [@davies2017canopy; @oram2018abundance] or shorter to
increase nest detection. The survey interval is long enough to allow the animals to roam around and build
new nest clusters at different locations. The surveys must be done at least three times for consistency
(~Law of averages). Since I am interested in re-distribution of nests, all nest classes will be
recorded. More importantly, I want all nests' GPS coordinates and nesting trees marked accurately and
labeled clearly. If orangutans do move between TPAs, I should see new nest clusters popping up inside the
proposed wildlife corridor at different sampling sessions, like in example shown below.

```{r fig2, echo = FALSE, fig.height = 5, fig.width = 12, fig.align = 'center'}
	p1 <- ggplot() + 
		#geom_tile(aes(x = study_area$x, y = study_area$y, fill = study_area$forest), show.legend = FALSE) +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[2], xmax = c_borderX[3], ymin = c_borderY[2], ymax = c_borderY[5]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[1], ymax = c_borderY[2]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[5], ymax = c_borderY[6]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_segment(aes(x = centre_line[2], xend = centre_line[2], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[3], xend = centre_line[3], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[4], xend = centre_line[4], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[5], xend = centre_line[5], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[6], xend = centre_line[6], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[7], xend = centre_line[7], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[8], xend = centre_line[8], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_point(aes(x = data[data$session == "A",]$x, 
					   y = data[data$session == "A",]$y, 
					   size = data[data$session == "A",]$count), shape = 1, colour = "magenta", show.legend = FALSE) +
		scale_fill_gradient(low = "grey88", high = "#009E73") +
		xlab("x-coordinate") +
		ylab("y-coordinate") +
		ggtitle("sessionA") +
  		theme_bw() + 
		theme(plot.title = element_text(hjust = 0.5))
	p2 <- ggplot() + 
		#geom_tile(aes(x = study_area$x, y = study_area$y, fill = study_area$forest), show.legend = FALSE) +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[2], xmax = c_borderX[3], ymin = c_borderY[2], ymax = c_borderY[5]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[1], ymax = c_borderY[2]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[5], ymax = c_borderY[6]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_segment(aes(x = centre_line[2], xend = centre_line[2], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[3], xend = centre_line[3], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[4], xend = centre_line[4], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[5], xend = centre_line[5], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[6], xend = centre_line[6], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[7], xend = centre_line[7], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[8], xend = centre_line[8], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_point(aes(x = data[data$session == "B",]$x, 
					   y = data[data$session == "B",]$y, 
					   size = data[data$session == "B",]$count), shape = 1, colour = "magenta", show.legend = FALSE) +
		scale_fill_gradient(low = "grey88", high = "#009E73") +
		xlab("x-coordinate") +
		ylab("y-coordinate") +
		ggtitle("sessionB") +
  		theme_bw() + 
		theme(plot.title = element_text(hjust = 0.5))
	p3 <- ggplot() + 
		#geom_tile(aes(x = study_area$x, y = study_area$y, fill = study_area$forest), show.legend = FALSE) +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[2], xmax = c_borderX[3], ymin = c_borderY[2], ymax = c_borderY[5]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[1], ymax = c_borderY[2]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[5], ymax = c_borderY[6]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_segment(aes(x = centre_line[2], xend = centre_line[2], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[3], xend = centre_line[3], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[4], xend = centre_line[4], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[5], xend = centre_line[5], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[6], xend = centre_line[6], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[7], xend = centre_line[7], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[8], xend = centre_line[8], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_point(aes(x = data[data$session == "C",]$x, 
					   y = data[data$session == "C",]$y, 
					   size = data[data$session == "C",]$count), shape = 1, colour = "magenta", show.legend = FALSE) +
		scale_fill_gradient(low = "grey88", high = "#009E73") +
		xlab("x-coordinate") +
		ylab("y-coordinate") +
		ggtitle("sessionC") +
  		theme_bw() + 
		theme(plot.title = element_text(hjust = 0.5))
	cowplot::plot_grid(p1, p2, p3, nrow=1)
```
\
Fit Penalised Regression Splines (PRS) using the \texttt{gam} function in the \texttt{mgcv} package
[@wood2017generalized] in \texttt{R}, and use coefficients from the models to predict count for the entire
environment at different phases.

```{r fit}
#Fit Penalised Regression Splines (PRS)
fit1 <- gam(count ~ s(x) + s(y), family = poisson, data = data[data$session == "A",])
fit2 <- gam(count ~ s(x) + s(y), family = poisson, data = data[data$session == "B",])
fit3 <- gam(count ~ s(x) + s(y), family = poisson, data = data[data$session == "C",])

#Use coefficients to predict
surveyA <- predict(fit1, type = "response", se.fit = TRUE, newdata = study_area)
surveyB <- predict(fit2, type = "response", se.fit = TRUE, newdata = study_area)
surveyC <- predict(fit3, type = "response", se.fit = TRUE, newdata = study_area)
```

Similar to Species Distribution Modeling (SDM), this analysis tells us which part of the environment will
likely have more nests. I think improving the prediction includes using non-Euclidean movement
[@sutherland2015modelling], rasters that depict anthropogenic influence on the environment
[@palminteri2012lidar; @manduell2012forest], and Bayesian analysis [@wade2000bayesian], but I will try out
these ideas later when I have more time to run the simulations. The bottom line is that I assume orangutans
utilize areas with more nests. The proposed wildlife corridor should prioritize these areas (and it may be
necessary to adjust the current coverage later in the final proposal).

```{r fig3, echo = FALSE, fig.height = 5, fig.width = 12, fig.align = 'center'}
	map_gam <- ggplot() + 
		geom_tile(aes(x = study_area$x, y = study_area$y, fill = surveyA$fit), show.legend = FALSE) +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[2], xmax = c_borderX[3], ymin = c_borderY[2], ymax = c_borderY[5]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[1], ymax = c_borderY[2]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[5], ymax = c_borderY[6]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_segment(aes(x = centre_line[2], xend = centre_line[2], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[3], xend = centre_line[3], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[4], xend = centre_line[4], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[5], xend = centre_line[5], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[6], xend = centre_line[6], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[7], xend = centre_line[7], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[8], xend = centre_line[8], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_point(aes(x = data[data$session == "A",]$x, 
					   y = data[data$session == "A",]$y, 
					   size = data[data$session == "A",]$count), shape = 1, colour = "magenta", show.legend = FALSE) +
		scale_fill_viridis() +
		xlab("x-coordinate") +
		ylab("y-coordinate") +
		ggtitle("sessionA") +
  		theme_bw() + 
		theme(plot.title = element_text(hjust = 0.5))
	map_gam2 <- ggplot() + 
		geom_tile(aes(x = study_area$x, y = study_area$y, fill = surveyB$fit), show.legend = FALSE) +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[2], xmax = c_borderX[3], ymin = c_borderY[2], ymax = c_borderY[5]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[1], ymax = c_borderY[2]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[5], ymax = c_borderY[6]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_segment(aes(x = centre_line[2], xend = centre_line[2], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[3], xend = centre_line[3], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[4], xend = centre_line[4], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[5], xend = centre_line[5], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[6], xend = centre_line[6], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[7], xend = centre_line[7], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[8], xend = centre_line[8], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_point(aes(x = data[data$session == "B",]$x, 
					   y = data[data$session == "B",]$y, 
					   size = data[data$session == "B",]$count), shape = 1, colour = "magenta", show.legend = FALSE) +
		scale_fill_viridis() +
		xlab("x-coordinate") +
		ylab("y-coordinate") +
		ggtitle("sessionB") +
  		theme_bw() + 
		theme(plot.title = element_text(hjust = 0.5))
	map_gam3 <- ggplot() + 
		geom_tile(aes(x = study_area$x, y = study_area$y, fill = surveyC$fit), show.legend = FALSE) +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[2], xmax = c_borderX[3], ymin = c_borderY[2], ymax = c_borderY[5]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[1], ymax = c_borderY[2]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_rect(aes(NULL, NULL, xmin = c_borderX[1], xmax = c_borderX[4], ymin = c_borderY[5], ymax = c_borderY[6]), 
				  fill = "white", size =1, alpha = 0, colour="red", linetype = "dashed") +
		geom_segment(aes(x = centre_line[2], xend = centre_line[2], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[3], xend = centre_line[3], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[4], xend = centre_line[4], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[5], xend = centre_line[5], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[6], xend = centre_line[6], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[7], xend = centre_line[7], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_segment(aes(x = centre_line[8], xend = centre_line[8], y = 100, yend = 900), size = 0.5, colour = "black", linetype = "dashed") +
		geom_point(aes(x = data[data$session == "C",]$x, 
					   y = data[data$session == "C",]$y, 
					   size = data[data$session == "C",]$count), shape = 1, colour = "magenta", show.legend = FALSE) +
		scale_fill_viridis() +
		xlab("x-coordinate") +
		ylab("y-coordinate") +
		ggtitle("sessionC") +
  		theme_bw() + 
		theme(plot.title = element_text(hjust = 0.5))
	cowplot::plot_grid(map_gam, map_gam2, map_gam3, nrow = 1)
```
```{r result, include = FALSE}
	new_data <- data.frame(x = rep(mean(study_area$x), 100),
						   y = seq(1, 1000, length = 100),
					       elevation = rep(mean(study_area$elevation), 100),
					       forest = rep(mean(study_area$forest), 100))
	predicted <- predict(fit3, type = "response", se.fit = TRUE, newdata = new_data)
	lcl <- predicted$fit - (2 * predicted$se.fit)
	hcl <- predicted$fit + (2 * predicted$se.fit)
	effect_y <- ggplot() +
					 geom_line(aes(x = new_data$y, y = predicted$fit), colour = "skyblue", size = 1.3) +
					 geom_ribbon(aes(x = new_data$y, ymin = lcl, ymax = hcl), fill = "skyblue", alpha = 0.5) +
					 xlab("y-coordinate") +
					 ylab("count_predicted") +
					 theme_light() 	
	new_data <- data.frame(x = rep(mean(study_area$x), 100),
						   y = rep(mean(study_area$y), 100),
						   elevation = seq(0, 2000, length = 100),
						   forest = rep(mean(study_area$forest), 100))
	predicted <- predict(fit3, type = "response", se = TRUE, newdata = new_data)
	lcl <- predicted$fit - (2 * predicted$se.fit)
	hcl <- predicted$fit + (2 * predicted$se.fit)
	effect_elevation <- ggplot() +
					 geom_line(aes(x = new_data$elevation, y = predicted$fit), colour = "skyblue", size = 1.3) +
					 geom_ribbon(aes(x = new_data$elevation, ymin = lcl, ymax = hcl), fill = "skyblue", alpha = 0.5) +
					 xlab("elevation") +
					 ylab("count_predicted") +
					 theme_light()
	new_data <- data.frame(x = rep(mean(study_area$x), 100),
						   y = rep(mean(study_area$y), 100),
						   elevation = rep(mean(study_area$elevation), 100),
						   forest = seq(0, 1, length = 100))
	predicted <- predict(fit3, type = "response", se.fit = TRUE, newdata = new_data)
	lcl <- predicted$fit - (2 * predicted$se.fit)
	hcl <- predicted$fit + (2 * predicted$se.fit)
	effect_forest <- ggplot() +
					 geom_line(aes(x = new_data$forest, y = predicted$fit), colour = "skyblue", size = 1.3) +
					 geom_ribbon(aes(x = new_data$forest, ymin = lcl, ymax = hcl), fill = "skyblue", alpha = 0.5) +
					 xlab("forest") +
					 ylab("count_predicted") +
					 theme_light()
	cowplot::plot_grid(effect_y, effect_elevation, effect_forest, nrow = 1)
```

## Questions

should try observations from different sessions should be analysed as one, one set of coefficients.
family = binomuil (count > binary)
if the study area is big enough and the surveys covers most of the area, we could see how the cluster of nests 'move'
extend model to include relative distance to human settlements 
non-Euclidean distance for estimating path of travel (Sutherland, )

## Reference



